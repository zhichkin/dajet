## DaJet web api vs 1С http сервисы

[DaJet blog](https://github.com/zhichkin/dajet/tree/main/doc/blog/README.md)

Поводом для написания этой статьи явилось желание рассказать о тех возможностях, которые DaJet предоставляет, когда речь заходит о доступе к базам данных по протоколу HTTP или, другими словами, при помощи web api. При этом само собой напросилась мысль сравнить производительность аналогичных технологий DaJet и 1С:Предприятие 8.

DaJet реализует два варианта:
- DaJet Script web api
- DaJet database web api

Первое отличается от второго большей гибкостью и функциональностью. В свою очередь database web api может работать только с одним запросом к базе данных и всё. Важно отметить, что, в текущей версии DaJet 3.11.x, существенным отличием между двумя этими возможностями является способ кэширования метаданных 1С:Предприятие в оперативной памяти сервера (хоста) DaJet. Это оказывает решающее значение на производительность! В частности DaJet Script кэширует метаданные на уровне скрипта, а его собрат - на уровне всего сервера, где может выполняться большое количество скриптов.

Целью данной статьи является показать разницу в производительности различных технологий и пообщать исправить это в будущих версиях платформы DaJet. =)

Итак начнём ...

Железо:
- RAM 8 Gb
- CPU Intel Core i5-4460 3.20 GHz (4 ядра)
- SSD Samsung 870 EVO 500 Gb

Софт:
- Windows 10 Pro
- Microsoft SQL Server 2022 (developer edition)
- 1С:Предприятие 8.3.27.1508
- Internet Information Services 10.0.19041.320
- DaJet 3.11.3 (.NET 8)
- Kestrel web server 1.0.2

Для выполнения нагрузочного тестирования используем NBomber 6.0.2. Разное количество пользователей (потоков) будут пытаться выполнить как можно больше запросов за 10 секунд.

> Весь софт используется как есть "из коробки" без оптимизаций.

В качестве теста будем использовать простой запрос к базе данных конфигурации 1С:Управление нашей фирмой. Запрос будет выбирать только один элемент справочника "Номенклатура" по его коду. Несмотря на всю простоту такого решения, этого достаточно, чтобы задействовать все подсистемы платформы: движок языка, загрузку метаданных, парсер запроса, обращение к базе данных. В свою очередь конфигурация 1С:УНФ это достаточно большая конфигурация, которая хорошо подходит для наглядной демонстарции разницы в способах использования кэша метаданных.

Для 1С мы сделаем исключение: она не будет выполнять запрос к базе данных. Более того конфигурация будет минимальной - чуть больше десятка объектов. HTTP-сервис 1С будет просто возвращать строковое значение.

**Код HTTP-сервиса 1С:Предприятие**
```
Функция test_POST(Запрос)
	
	Ответ = Новый HTTPСервисОтвет(200);
	UTF8  = КодировкаТекста.UTF8;
	NoBOM = ИспользованиеByteOrderMark.НеИспользовать;
	
	Ответ.УстановитьТелоИзСтроки("OK", UTF8, NoBOM);
	
	Возврат Ответ;
	
КонецФункции
```

**Скрипт DaJet database web api**
```
SELECT Ссылка, Код, Наименование
  FROM Справочник.Номенклатура
 WHERE Код = 'ФР-00000285'
```

**Скрипт DaJet Script web api**
```
DECLARE @object object

USE 'mssql://zhichkin/unf'
   SELECT Ссылка, Код, Наименование
     INTO @object
     FROM Справочник.Номенклатура
    WHERE Код = 'ФР-00000285'
END

RETURN @object
```

##### Тест HTTP-сервиса 1С

